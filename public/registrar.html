<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <title>æ¼«æ¼«æµå®  Â· ç™»è®°äººå‘˜å·¥ä½œå°</title>
  <style>
    body {
      margin: 0;
      font-family: "Segoe UI","PingFang SC",Arial,sans-serif;
      background: linear-gradient(135deg,#fff1eb,#ace0f9);
      padding: 30px;
    }

    h1 { margin-bottom: 20px; }

    .box {
      background: #fff;
      border-radius: 16px;
      padding: 20px;
      margin-bottom: 24px;
      box-shadow: 0 8px 18px rgba(0,0,0,.15);
    }

    label {
      display: block;
      margin-top: 10px;
      font-size: 14px;
    }

    input, textarea, select {
      width: 100%;
      padding: 8px;
      border-radius: 8px;
      border: 1px solid #ccc;
      margin-top: 4px;
    }

    button {
      margin-top: 14px;
      padding: 10px;
      border-radius: 10px;
      border: none;
      cursor: pointer;
      background: #ff7a7a;
      color: #fff;
      font-size: 14px;
    }

    .secondary {
      background:#607d8b;
    }

    .nav {
      margin-bottom: 20px;
    }

    .nav a {
      margin-right: 16px;
      font-size: 14px;
      text-decoration: none;
      color: #333;
    }

    hr {
      margin: 24px 0;
    }
  </style>
</head>

<body>

<div class="nav">
  <a href="/index.html">è¿”å›é¦–é¡µ</a>
  <a href="/revenue.html">ç›ˆåˆ©ä¸­å¿ƒ</a>
</div>

<h1>ğŸ“‹ ç™»è®°äººå‘˜ Â· åŠ¨ç‰©ç™»è®°ä¸å‘å¸ƒ</h1>

<!-- åŸºç¡€ä¿¡æ¯ -->
<div class="box">
  <h2>åŠ¨ç‰©åŸºç¡€ä¿¡æ¯</h2>
  
  <label>åŠ¨ç‰©åç§°
    <input id="name">
  </label>

  <label>ç§ç±»
    <select id="species">
      <option value="çŒ«">çŒ«</option>
      <option value="ç‹—">ç‹—</option>
    </select>
  </label>

  <label>å¯„å…»ç±»å‹
    <select id="fosterType">
      <option value="family">å®¶åº­å¯„å…»</option>
      <option value="shelter">æœºæ„å¯„å…»</option>
    </select>
  </label>

  <label>æ€§åˆ«
    <select id="sex">
      <option value="æœªçŸ¥">æœªçŸ¥</option>
      <option value="å…¬">å…¬</option>
      <option value="æ¯">æ¯</option>
    </select>
  </label>

  <label>å¹´é¾„ï¼ˆçº¦ï¼‰
    <input id="age">
  </label>

  <label>å‘ç°åœ°ç‚¹
    <input id="location">
  </label>

  <label>æƒ…å†µè¯´æ˜
    <textarea id="description"></textarea>
  </label>

  <button onclick="createAnimal()">åˆ›å»ºåŠ¨ç‰©æ¡£æ¡ˆ</button>

  <hr>

  <h3>å‘å¸ƒåŠ¨ç‰©</h3>

  <label>åŠ¨ç‰© IDï¼ˆåˆ›å»ºå®Œæˆåè‡ªåŠ¨å¡«å†™ï¼‰
    <input id="publishAnimalId">
  </label>

  <button class="secondary" onclick="publishAnimal()">å‘å¸ƒ / ä¸Šæ¶åŠ¨ç‰©</button>
</div>

<!-- å¥åº·ä¿¡æ¯ -->
<div class="box">
  <h2>å¥åº·ä¸åŒ»ç–—ä¿¡æ¯</h2>

  <label>åŠ¨ç‰© ID
    <input id="animalId">
  </label>

  <label>
    <input type="checkbox" id="vaccinated"> å·²æ¥ç§ç–«è‹—
  </label>

  <label>
    <input type="checkbox" id="neutered"> å·²ç»è‚²
  </label>

  <label>
    <input type="checkbox" id="dewormed"> å·²é©±è™«
  </label>

  <label>å¥åº·å¤‡æ³¨
    <textarea id="notes"></textarea>
  </label>

  <button onclick="saveHealth()">ä¿å­˜å¥åº·ä¿¡æ¯</button>
  <button class="secondary" onclick="loadHealth()">æŸ¥çœ‹å¥åº·æ¡£æ¡ˆ</button>

  <div id="healthView"></div>
</div>

<script>
  async function createAnimal() {
    const res = await fetch('/api/animals', {
      method:'POST',
      headers:{'Content-Type':'application/json'},
      body:JSON.stringify({
        name: document.getElementById('name').value,
        species: document.getElementById('species').value,
        foster_type: document.getElementById('fosterType').value,
        sex: document.getElementById('sex').value,
        age: document.getElementById('age').value,
        location: document.getElementById('location').value,
        description: document.getElementById('description').value
      })
    });

    const data = await res.json();
    if (res.ok) {
      alert('åˆ›å»ºæˆåŠŸï¼ŒåŠ¨ç‰© IDï¼š' + data.animalId);
      document.getElementById('animalId').value = data.animalId;
      document.getElementById('publishAnimalId').value = data.animalId;
    } else {
      alert(data.error || 'åˆ›å»ºå¤±è´¥');
    }
  }


  async function publishAnimal() {
    const id = document.getElementById('publishAnimalId').value;
    if (!id) {
      alert("è¯·å¡«å†™åŠ¨ç‰© ID");
      return;
    }

    const res = await fetch(`/api/animals/${id}/publish`, { method:'POST' });
    const data = await res.json();

    if (res.ok) {
      alert("åŠ¨ç‰©å·²æˆåŠŸä¸Šæ¶ï¼Œç”¨æˆ·ç«¯å¯è§");
    } else {
      alert(data.error || "å‘å¸ƒå¤±è´¥");
    }
  }

  async function saveHealth() {
    const id = document.getElementById('animalId').value;
    if (!id) {
      alert('è¯·å…ˆå¡«å†™åŠ¨ç‰© ID');
      return;
    }

    const res = await fetch(`/api/animals/${id}/health`, {
      method:'POST',
      headers:{'Content-Type':'application/json'},
      body:JSON.stringify({
        vaccinated: document.getElementById('vaccinated').checked,
        neutered: document.getElementById('neutered').checked,
        dewormed: document.getElementById('dewormed').checked,
        notes: document.getElementById('notes').value
      })
    });

    const data = await res.json();
    if (res.ok) {
      alert('å¥åº·ä¿¡æ¯å·²ä¿å­˜');
    } else {
      alert(data.error || 'ä¿å­˜å¤±è´¥');
    }
  }

  async function loadHealth() {
    const id = document.getElementById('animalId').value;
    if (!id) {
      alert("è¯·å¡«å†™åŠ¨ç‰© ID");
      return;
    }

    const res = await fetch(`/api/animals/${id}/health`);
    const data = await res.json();

    if (!res.ok) {
      alert(data.error || "æ— æ³•è¯»å–å¥åº·æ¡£æ¡ˆ");
      return;
    }

    document.getElementById('healthView').innerHTML = `
      <h3>ğŸ¾ ${data.name}ï¼ˆ${data.species}ï¼‰</h3>
      <p>ç–«è‹—ï¼š${data.vaccinated ? "å·²æ¥ç§" : "æœªæ¥ç§"}</p>
      <p>ç»è‚²ï¼š${data.neutered ? "å·²ç»è‚²" : "æœªç»è‚²"}</p>
      <p>é©±è™«ï¼š${data.dewormed ? "å·²é©±è™«" : "æœªé©±è™«"}</p>
      <p>å¤‡æ³¨ï¼š${data.notes || "æ— "}</p>
    `;
  }
</script>

</body>
</html>
